<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment - Profit Pricer</title>
<link rel="icon" href="/assets/images/favicon.png" type="image/x-icon">
<style>
    body {
        height: 100vh;
        margin: 0;
        background-color: #f8f9fa;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
    }

    .logo-container {
        position: absolute;
        top: 20px;
        left: 30px;
    }

    .logo-container img {
        width: 120px;
        height: auto;
    }

    /* Centered payment card */
    .payment-card {
        background-color: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
        width: 100%;
        max-width: 500px;
        box-sizing: border-box;
    }

    .greeting {
        margin-bottom: 20px;
        font-size: 18px;
        color: #333;
    }

    .greeting span {
        font-weight: bold;
    }

    .payment-form h2 {
        font-size: 24px;
        font-weight: 600;
        color: #333;
        margin-top: 0;
        margin-bottom: 20px;
        text-align: left;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-row {
        display: flex;
        gap: 20px;
    }

    .form-row .form-group {
        flex: 1;
    }

    label {
        display: block;
        font-size: 14px;
        color: #555;
        margin-bottom: 8px;
        font-weight: 500;
    }

    input[type="text"],
    input[type="password"] {
        width: 100%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 16px;
        box-sizing: border-box;
        transition: border-color 0.3s, box-shadow 0.3s;
    }

    input:focus {
        outline: none;
        border-color: #28a745;
        box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
    }

    input.error {
        border-color: #dc3545;
    }
    
    input.error:focus {
         box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
    }

    button {
        width: 100%;
        padding: 15px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    button:hover {
        background-color: #218838;
    }

    .message-box {
        padding: 10px;
        margin-top: 20px;
        border-radius: 6px;
        text-align: center;
        font-weight: 500;
        display: none;
    }

    .message-box.success {
        background-color: #d4edda;
        color: #155724;
        display: block;
    }

    .message-box.error {
        background-color: #f8d7da;
        color: #721c24;
        display: block;
    }
</style>
</head>

<body>

    <div class="logo-container">
        <img src="/assets/images/logo.png" alt="Profit Pricer Logo">
    </div>

    <div class="payment-card">
        <div class="greeting">
            Hi <span id="userName"></span>, Welcome to Profit Pricer Family
        </div>

        <form class="payment-form" id="paymentForm" novalidate>
            <h2>Use Card for Payment</h2>

            <div class="form-group">
                <label>Plan Selected</label>
                <input type="text" id="planField" readonly>
            </div>

            <div class="form-group">
                <label>Credit Card</label>
                <input type="text" id="cardNumber" placeholder="XXXX XXXX XXXX XXXX" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Expiration Date</label>
                    <input type="text" id="expiryDate" placeholder="MM / YY" required>
                </div>
                <div class="form-group">
                    <label>CCV</label>
                    <input type="password" id="ccv" placeholder="***" maxlength="4" required>
                </div>
            </div>

            <div class="form-group">
                <label>Name</label>
                <input type="text" id="customerName" placeholder="Full Name" required>
            </div>

            <button type="submit">Proceed with Payment</button>
            <div id="messageBox" class="message-box"></div>
        </form>
    </div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const fullName = localStorage.getItem("fullName") || "";
        const selectedPlan = localStorage.getItem("selectedPlan") || "";

        document.getElementById("userName").textContent = fullName;
        document.getElementById("planField").value = selectedPlan ? `Profit Pricer: ${selectedPlan}` : "";

        document.getElementById("cardNumber").value = "";
        document.getElementById("expiryDate").value = "";
        document.getElementById("ccv").value = "";
        document.getElementById("customerName").value = "";
    });

    const paymentForm = document.getElementById('paymentForm');
    const cardNumberInput = document.getElementById('cardNumber');
    const expiryDateInput = document.getElementById('expiryDate');
    const ccvInput = document.getElementById('ccv');
    const nameInput = document.getElementById('customerName');
    const messageBox = document.getElementById('messageBox');

    cardNumberInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, ''); 
        let formattedValue = (value.match(/.{1,4}/g) || []).join(' ');
        e.target.value = formattedValue.substring(0, 19);
    });

    expiryDateInput.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, ''); 
        if (value.length > 2) {
            value = `${value.substring(0, 2)} / ${value.substring(2, 4)}`;
        }
        e.target.value = value;
    });

    ccvInput.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/\D/g, ''); 
    });

    nameInput.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/[^a-zA-Z\s]/g, '');
    });


    // --- FORM SUBMISSION VALIDATION ---
    paymentForm.addEventListener('submit', function (event) {
        event.preventDefault();

        [cardNumberInput, expiryDateInput, ccvInput, nameInput].forEach(input => input.classList.remove('error'));
        messageBox.className = 'message-box';
        messageBox.style.display = 'none';

        let isValid = true;
        let errorMessages = [];

        // --- Validation Checks ---
        // 1. Card Number Validation (must be 16 digits)
        const cardNumberRegex = /^\d{4} \d{4} \d{4} \d{4}$/;
        if (!cardNumberRegex.test(cardNumberInput.value)) {
            cardNumberInput.classList.add('error');
            isValid = false;
            errorMessages.push('Invalid card number.');
        }

        // 2. Expiry Date Validation (must be MM / YY and not in the past)
        const expiryDateRegex = /^(0[1-9]|1[0-2]) \/ (\d{2})$/;
        if (!expiryDateRegex.test(expiryDateInput.value)) {
            expiryDateInput.classList.add('error');
            isValid = false;
            errorMessages.push('Invalid expiry date format.');
        } else {
            const [month, year] = expiryDateInput.value.split(' / ').map(Number);
            const currentYear = new Date().getFullYear() % 100;
            const currentMonth = new Date().getMonth() + 1;
            if (year < currentYear || (year === currentYear && month < currentMonth)) {
                expiryDateInput.classList.add('error');
                isValid = false;
                errorMessages.push('Card has expired.');
            }
        }

        // 3. CCV Validation (must be 3 or 4 digits)
        const ccvRegex = /^\d{3,4}$/;
        if (!ccvRegex.test(ccvInput.value)) {
            ccvInput.classList.add('error');
            isValid = false;
            errorMessages.push('Invalid CCV.');
        }
        
        // 4. Name Validation (must not be empty and contain only letters/spaces)
        if (nameInput.value.trim() === '' || !/^[a-zA-Z\s]+$/.test(nameInput.value)) {
            nameInput.classList.add('error');
            isValid = false;
            errorMessages.push('Invalid name.');
        }

        // --- Display final message ---
        if (isValid) {
            messageBox.textContent = 'Payment processing... Success!';
            messageBox.classList.add('success');
        } else {
            messageBox.textContent = 'Please fix the following errors: ' + errorMessages.join(' ');
            messageBox.classList.add('error');
        }
    });
</script>

</body>
</html>